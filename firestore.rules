
// ===============================================================================
// ⚠️ ACTION REQUIRED: HOW TO APPLY THESE RULES
// ===============================================================================
// 1. Go to Firebase Console (https://console.firebase.google.com)
// 2. Navigate to: Build -> Firestore Database -> Rules (Tab)
// 3. Delete the existing code in the editor.
// 4. Copy and Paste ALL the code below into the editor.
// 5. Click "Publish".
// ===============================================================================

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // User Profiles:
    // read: Allow public read to enable "Admin" identity verification (lookup by email)
    // create: Allow authenticated users to create their own profile during registration
    // update/delete: Strictly owner only (authenticated user matching the document ID)
    match /users/{userId} {
      allow read: if true;
      allow create: if request.auth != null && request.auth.uid == userId;
      allow update, delete: if request.auth != null && request.auth.uid == userId;
    }
    
    // Courses: Publicly readable for the catalog
    match /courses/{courseId} {
      allow read: if true;
    }
    
    // Orders: Users can read their own orders. Authenticated users can create orders.
    match /orders/{orderId} {
      allow read: if request.auth != null && resource.data.userId == request.auth.uid;
      allow create: if request.auth != null;
    }
    
    // Redemption Codes: 
    // read: Authenticated users (to redeem)
    // create: Public (so unauthenticated "Admin" can generate codes via the portal)
    // update: Authenticated users (marking as redeemed)
    match /redemptionCodes/{codeId} {
      allow read: if request.auth != null;
      allow update: if request.auth != null; 
      allow create: if true;
    }
  }
}
